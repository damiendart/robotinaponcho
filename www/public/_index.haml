-# Homepage Haml markup for Damien Dart's personal website.
-#
-# Copyright (C) 2013-2015 Damien Dart, <damiendart@pobox.com>.
-# This file is distributed under the MIT licence. For more information,
-# please refer to the accompanying "LICENCE" file.

- require "yaml"
- data = YAML.load(File.read(File.join(File.dirname(__FILE__), "public", "_index.yaml")))

!!! 5
%html{:lang => "en"}
  %head
    %meta{:content => "text/html; charset=utf-8", :"http-equiv" => "Content-Type"}
    %meta{:content => "initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width", "name" => "viewport"}
    %script{:src => "/assets/jquery-1.10.1.min.js"}
    %script{:src => "//use.typekit.net/zkk4eyh.js"}
    %script try{Typekit.load();}catch(e){}
    :scss
      #{File.read(File.join(File.dirname(__FILE__), "public", "_index.scss"))}
    %title Damien Dart's Personal Site (www.robotinaponcho.net)
  %body
    .page-content
      %p.page-content__header.tk-adelle <b>Hello! I'm Damien Dart.</b> I occasionally make things:
      %ul.page-content__project-list
        - data["projects"].each do |project|
          %li.page-content__project-list__item>
            .panel{:"data-code-example" => (project["code_example"] ? "#{project['code_example']}" : nil), :"data-image" => (project["image"] ? "#{project['image']}" : nil)}
              .panel__description 
                %strong.tk-adelle #{project["title"]}<br>
                = project["description"]
    :javascript
      $(".panel").each(function(i) {
        if($(this).attr("data-image")) {
          $(this).prepend("<img class=\"panel__js-image\" onLoad=\"this.style.opacity = 1\" src=\"" + $(this).data("image") + "\">");
        } else if($(this).attr("data-code-example")) {
          var panel = $(this);
          $.get($(this).data("code-example"), function(data) {
            panel.addClass("panel--js-code");
            line_number = parseInt(panel.data("code-example").split("#")[1]);
            code = data.split("\n").slice(line_number, line_number + 25).join("\n");
            panel.prepend("<pre class=\"panel__js-code\">" + code + "</pre>");
          });
        }
      });

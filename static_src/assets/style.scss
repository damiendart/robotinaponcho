// Copyright (C) 2020 Damien Dart, <damiendart@pobox.com>.
// This file is distributed under the MIT licence. For more information,
// please refer to the accompanying "LICENCE" file.

@use "node_modules/toolbox-sass";

$base-font-size: toolbox-sass.$base-one-em-in-pixels;
// The not-quite-1.7 value prevents a bunch of decimal pixel values
// that cause things to look ever-so-slightly off.
$base-line-height: 1.6875rem;
$colour-black: #000000;
$colour-blue: #0984e3;
$colour-flippywindow-blue: #65b3eb;
$colour-gray: #dddddd;
$colour-gray-light: #eeeeee;
$colour-green: #55efc4;
$colour-itchio-pink: #fa5c5c;
$colour-orange: #fdcb6e;
$colour-white: #ffffff;
$content-width: 37.5rem;

@font-face {
  font-display: swap;
  font-family: 'Inter';
  font-style:  normal;
  font-weight: 400;
  src: url("inter-regular.woff2") format("woff2");
}

@font-face {
  font-display: swap;
  font-family: 'Inter';
  font-style:  italic;
  font-weight: 400;
  src: url("inter-italic.woff2") format("woff2");
}

@font-face {
  font-display: swap;
  font-family: 'Inter';
  font-style:  normal;
  font-weight: 700;
  src: url("inter-bold.woff2") format("woff2");
}

@font-face {
  font-display: swap;
  font-family: 'Iosevka Web';
  font-stretch: normal;
  font-style: normal;
  font-weight: 400;
  src: url('iosevka-regular.woff2') format('woff2');
}

@font-face {
  font-display: swap;
  font-family: 'Iosevka Web';
  font-stretch: normal;
  font-style: italic;
  font-weight: 400;
  src: url('iosevka-italic.woff2') format('woff2');
}

@font-face {
  font-display: swap;
  font-family: 'Iosevka Web';
  font-stretch: normal;
  font-style: normal;
  font-weight: 700;
  src: url('iosevka-bold.woff2') format('woff2');
}

a {
  color: $colour-blue;
  font-weight: bold;
  text-decoration: underline $colour-gray;
  text-decoration-thickness: $base-line-height / 16;

  &:active,
  &:focus,
  &:hover,
  &:visited,
  &:visited:hover {
    text-decoration-color: currentColor;
  }

  &:focus {
    outline: (toolbox-sass.$base-one-pixel-in-rem * 2) solid $colour-blue;
  }
}

body {
  @include toolbox-sass.nice-font-rendering;

  background: $colour-white;
  color: $colour-black;
  font-family: 'Inter', toolbox-sass.$font-stack-system;
  line-height: $base-line-height;
  margin: 0;
}

code {
  background: $colour-gray-light;
  font-family: 'Iosevka Web', monospace;
  line-height: 1;
}

figure {
  @media #{toolbox-sass.$media-small-down} {
    -webkit-overflow-scrolling: touch;
    overflow-x: auto;
    overflow-y: hidden;
    position: relative;
  }

  > *:last-child {
    position: relative;

    &::after {
      @media #{toolbox-sass.$media-small-down} {
        content: "";
        display: block;
        height: toolbox-sass.$base-one-pixel-in-rem;
        position: absolute;
        right: $base-line-height * -1;
        width: $base-line-height;
      }
    }
  }
}

h1 {
  font-size: 200%;
  line-height: $base-line-height * 1.5;
  margin: $base-line-height * 3 0;
  text-align: center;

  @media #{toolbox-sass.$media-medium-up} {
    font-size: 300%;
    line-height: $base-line-height * 2;
  }
}

h2 {
  font-size: 150%;
  line-height: $base-line-height * 1.25;
  margin: ($base-line-height * 2.75) 0 0 0;
}

h3 {
  font-size: 100%;
  line-height: $base-line-height;
  margin: $base-line-height 0 0 0;
}

html {
  @include toolbox-sass.html-base($base-font-size);
}

img {
  height: auto;
  max-width: 100%;
}

kbd {
  background: $colour-gray-light;
  border-radius: $base-line-height / 4;
  font-size: 87.5%;
  font-family: inherit;
  line-height: 1;
  padding: $base-line-height / 4;
}

main {
  // Makes the "main" element behave correctly in Internet Explorer 11.
  display: block;
}

ol {
  margin: ($base-line-height / 2) 0 0 0;
  padding: 0;

  & > * {
    margin: 0 0 0 $base-line-height;
    padding: 0;

    & > ul, & > ol {
      margin: 0;
    }
  }
}

p {
  margin: ($base-line-height / 2) 0 0 0;
}

table {
  margin: ($base-line-height / 2) 0 0 0;
  border-collapse: collapse;
  width: 100%;

  > :not(caption) > * > * {
    padding: $base-line-height / 4;
  }

  > tbody > tr:nth-last-of-type(odd) {
    background: $colour-gray-light;
  }

  > thead {
    vertical-align: bottom;

    > * > * {
      border-bottom: $colour-black solid toolbox-sass.$base-one-pixel-in-rem;
      padding-bottom: (($base-line-height / 4) - toolbox-sass.$base-one-pixel-in-rem);
      padding-top: 0;
    }
  }
}

ul {
  list-style: square;
  margin: ($base-line-height / 2) 0 0 0;
  padding: 0;

  & > * {
    margin: 0 0 0 $base-line-height;
    padding: 0;

    & > ul, & > ol {
      margin: 0;
    }
  }
}

.admonition {
  border-style: solid;
  border-width: 0;
  border-left-width: $base-line-height * 3;
  box-sizing: border-box;
  margin: $base-line-height auto;
  max-width: $content-width + ($base-line-height * 2);
  position: relative;
  padding: $base-line-height $base-line-height
      $base-line-height ($base-line-height * 0.875);

  > *:first-child {
    margin: 0;
  }

  &:before {
    background-repeat: no-repeat;
    background-size: 100%;
    content: '';
    display: block;
    height: $base-line-height * 2;
    left: $base-line-height * -2.5;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: $base-line-height * 2;
  }

  &--info {
    border-color: $colour-orange;

    &:before {
      background-image: url("/assets/icon-info.svg");
    }
  }

  &--metadata {
    border-color: $colour-gray;

    &:before {
      background-image: url("/assets/icon-help.svg");
    }
  }

  @media screen and (min-width: #{$content-width + $base-line-height * 2}) {
    border-bottom-width: $base-line-height / 8;
    border-radius: $base-line-height / 2;
    border-right-width: $base-line-height / 8;
    border-top-width: $base-line-height / 8;
    padding: $base-line-height * 0.875;
  }
}

.anchor {
  position: absolute;
  margin: ($base-line-height * -2) 0 0;
  visibility: hidden;

  @media #{toolbox-sass.$media-ie-10} {
    margin: ($base-line-height * 1.5) 0 0;
  }
}

.button {
  background: $colour-blue;
  color: $colour-white;
  display: inline-block;
  font-weight: bold;
  padding: ($base-line-height / 2) $base-line-height;
  position: relative;
  border-radius: $base-line-height / 2;
  text-decoration: none;
  white-space: nowrap;

  &:hover {
    text-decoration: underline;
  }

  &--clipboard {
    &::before {
      background: inherit;
      content: "Copied!";
      left: $base-line-height / 2;
      opacity: 0;
      padding: ($base-line-height / 2) 0;
      position: absolute;
      right: $base-line-height / 2;
      text-align: center;
      top: 0;
      transition: opacity 0.125s ease-out;
    }

    &.clipboard-success {
      &::before {
        opacity: 1;
      }
    }
  }

  &--inverse {
    background: $colour-white;
    border: ($base-line-height / 8) solid currentColor;
    color: $colour-blue;
    padding: ($base-line-height * 0.375) ($base-line-height * 0.875);
  }

  &--itchio {
    background: $colour-itchio-pink;
    color: $colour-white;
  }

  img {
    height: $base-line-height;
    vertical-align: bottom;
  }
}

.button-list {
  list-style: none;
  margin-top: $base-line-height * 0.75;

  li {
    display: inline-block;
    margin: ($base-line-height / 4) ($base-line-height / 4) 0 0;
    padding: 0;
  }
}

.collapsible {
  &--x-small-down {
    @media #{toolbox-sass.$media-x-small-down} {
      display: none;
    }
  }

  &--small-down {
    @media #{toolbox-sass.$media-small-down} {
      display: none;
    }
  }

  &--medium-down {
    @media #{toolbox-sass.$media-medium-down} {
      display: none;
    }
  }
}

.colouring-page-cta {
  border-color: $colour-green;
  border-style: solid;
  border-width: 0;
  border-left-width: $base-line-height * 3;
  box-sizing: border-box;
  margin: $base-line-height auto;
  max-width: $content-width + ($base-line-height * 2);
  position: relative;
  padding: $base-line-height $base-line-height
  $base-line-height ($base-line-height * 0.875);

  > *:first-child {
    margin: 0;
  }

  @media screen and (min-width: #{$content-width + $base-line-height * 2}) {
    border-width: ($base-line-height / 8) ($base-line-height / 8)
      ($base-line-height / 8) ($base-line-height * 8);
    border-radius: $base-line-height / 2;
    padding: $base-line-height * 0.875;
  }

  &__samples {
    display: none;

    @media screen and (min-width: #{$content-width + $base-line-height * 2}) {
      bottom: $base-line-height / -8;
      display: block;
      height: calc(100% + #{$base-line-height / 4});
      left: $base-line-height * -9;
      overflow: hidden;
      position: absolute;
      width: $base-line-height * 10;

      &__heading {
        display: none;
      }

      &__sample {
        $sheet-width: $base-line-height * 6;

        top: -10%;
        box-shadow: 0 0 ($base-line-height / 2) rgba(0, 0, 0, 0.1);
        background: $colour-white;
        display: block;
        height: $sheet-width * 1.41429;
        left: 50%;
        position: absolute;
        transform: translateX(-50%) rotate(-2deg);
        width: $sheet-width;

        &--2 {
          top: 20%;
          transform: translateX(-50%) rotate(5deg);
        }

        &--3 {
          top: 40%;
          transform: translateX(-50%) rotate(-3deg);
        }

        &--4 {
          top: 60%;
          transform: translateX(-50%) rotate(4deg);
        }
      }
    }
  }
}

.download {
  margin: $base-line-height * 3 0;
  text-align: center;
  padding: 0 $base-line-height;

  &__link {
    line-height: $base-line-height;
    margin: 0;
  }

  &__information-list {
    list-style: none;
    margin: $base-line-height / 2 0 0 0;

    & > * {
      margin: 0;
    }
  }
}

.dropdown-menu {
  cursor: default;
  display: inline-block;
  margin: $base-line-height / -2;
  position: relative;

  @media (hover: hover) {
    // Microsoft Edge and Internet Explorer do not support the
    // ":focus-within" pseudo-class; if we include the pseudo-class in a
    // group of selectors those browsers ignore the whole thing.
    &:focus-within {
      background: $colour-black;
      color: $colour-white;
    }

    &:focus-within > &__lists {
      right: 0;
    }

    &:focus-within > &__title {
      background-image: url("icons-chevrons.svg#up");
    }

    &:hover {
      background: $colour-black;
      color: $colour-white;
    }

    &:hover > &__lists {
      right: 0;
    }

    &:hover > &__title {
      background-image: url("icons-chevrons.svg#up");
    }
  }

  @media (hover: none) {
    &--open {
      background: $colour-black;
      color: $colour-white;
    }

    &--open &__lists {
      right: 0;
    }

    &--open &__title {
      background-image: url("icons-chevrons.svg#up");
    }

    @at-root {
      html:not(.javascript) & {
        margin: 0;
        padding: 0;
        width: 100%;

        &__title {
          display: none;
        }

        &__lists {
          left: 0;
          float: none;
          margin: $base-line-height 0 0 0;
          padding: 0;
          position: relative;
          top: 0;
          width: 100%;
        }
      }
    }
  }

  // Internet Explorer 10 and 11 don't support interaction-related media
  // queries or SVG fragment identifiers.
  @media #{toolbox-sass.$media-ie-10} {
    &:hover {
      background: $colour-black;
      color: $colour-white;
    }

    &:hover > &__lists {
      right: 0;
    }

    &__title {
      background-image: none !important;
      padding: $base-line-height / 2 !important;
    }
  }

  &__title {
    background: url("icons-chevrons.svg#down") no-repeat right center;
    background-size: $base-line-height * 0.625;
    background-position-x: calc(100% - #{$base-line-height / 2});
    font-size: 100%;
    font-weight: bold;
    line-height: $base-line-height;
    margin: 0;
    padding:
        ($base-line-height / 2)
        ($base-line-height * 1.5)
        ($base-line-height / 2)
        ($base-line-height / 2);

    // Improve the user experience of the dropdown menu by adding a
    // "pointer-movement path" from the hamburger icon to the far-left
    // list of links. For more information, see
    // <https://css-tricks.com/dropdown-menus-with-more-forgiving-mouse-movement-paths/>.
    &:hover::before {
      bottom: 0;
      content: "";
      display: block;
      position: absolute;
      right: 100%;
      top: 0;
      transform: rotate(-25deg);
      transform-origin: 100% 0;
      width: 135%;
      z-index: 1;

      @media #{toolbox-sass.$media-medium-up} {
        transform: rotate(-10deg);
        width: 325%;
      }
    }

    * {
      display: inline-block;
      vertical-align: middle;
    }
  }

  &__lists {
    background: inherit;
    color: inherit;
    padding: $base-line-height;
    position: absolute;
    right: 9999px;
    top: 100%;
    z-index: 1;

    @media #{toolbox-sass.$media-medium-up} {
      columns: 2;
      column-gap: $base-line-height;
    }

    @media (hover: none) {
      @at-root {
        html:not(.javascript) & {
          right: 0;
        }
      }
    }

    &__list {
      break-inside: avoid;
      // This ensures that each list keeps to its own column in all
      // supported browsers.
      display: inline-table;
      list-style: none;
      margin: 0 0 ($base-line-height / 2) 0;
      white-space: pre;

      @media #{toolbox-sass.$media-medium-up} {
        margin: 0;
      }

      &:last-child {
        // This removes extra unwanted empty space from the bottom of
        // the dropdown in pre-Blink Microsoft Edge, because reasons.
        display: table;
        margin: 0;
      }

      &__item {
        margin: 0;
        padding: 0;
      }
    }
  }
}

.footer {
  border-top: ($base-line-height / 16) solid $colour-gray;
  margin: ($base-line-height * 3) auto 0;
  padding: $base-line-height;
  text-align: center;

  &__copyright {
    margin: 0;
  }

  &__rule {
    display: none;
  }
}

.flippywindow-introduction {
  background: url("/flippywindow/background.svg"), $colour-flippywindow-blue;
  background-size: cover;
  color: $colour-white;
  padding: ($base-line-height * 3) $base-line-height;

  &__blurb {
    font-size: 150%;
    font-weight: bold;
    line-height: $base-line-height * 1.5;
    margin: 0 auto $base-line-height auto;
    max-width: $content-width;
    padding: 0 $base-line-height;
    text-align: center;

    &--more {
      font-weight: normal;
      margin: $base-line-height auto 0;
    }

    a {
      color: inherit;
      text-decoration-color: currentColor;

      &:focus {
        outline-color: $colour-white;
      }
    }
  }

  &__screenshot-with-arrow {
    position: relative;
    margin: $base-line-height auto 0;
    max-width: 776px; // width of screenshot.

    &:after {
      background: url("/flippywindow/arrow.png") no-repeat 81% top;
      background-size: contain;
      content: "";
      display: block;
      height: percentage(301 / 557);
      position: absolute;
      top: $base-line-height / -2;
      width: 100%;
    }

    img {
      display: block;
    }
  }

  &__title {
    margin: 0 0 ($base-line-height * 3) 0;
  }
}

.hamburger {
  @include toolbox-sass.hamburger(
    $base-line-height * 1.5, $base-line-height / 6, $base-line-height / 4);
}

.header {
  @include toolbox-sass.clearfix;

  background: $colour-white;
  border-bottom: ($base-line-height / 16) solid $colour-gray;
  box-sizing: border-box;
  padding: $base-line-height;
  position: sticky;
  top: 0;
  transition: box-shadow 0.25s ease-in;
  margin: 0 0 ($base-line-height / -16) 0;
  width: 100%;
  z-index: 1;

  html:not(.javascript) & {
    position: relative;
  }

  &--shadow {
    box-shadow: 0 0 $base-line-height rgba(0, 0, 0, 0.1);
  }

  a {
    text-decoration: none;
    color: inherit;

    &:focus, &:hover {
      text-decoration: underline;
    }
  }

  &__title {
    float: left;
    font-size: 150%;
    line-height: $base-line-height;
    margin: 0;
  }

  &__navigation {
    float: right;
  }

  &__rule {
    display: none;
  }
}

.main-content {
  & > *:not(div) {
    margin-left: auto;
    margin-right: auto;
    max-width: $content-width;
    padding-left: $base-line-height;
    padding-right: $base-line-height;

    @media #{toolbox-sass.$media-large-up} {
      padding-left: $base-line-height * 2;
      padding-right: $base-line-height * 2;
    }
  }
}

.metadata-list {
  list-style: none;

  &__item {
    margin: 0;
  }
}

.notes-list {
  margin: ($base-line-height * 3) auto 0;
  max-width: $content-width;
  padding-left: $base-line-height;
  padding-right: $base-line-height;

  @media #{toolbox-sass.$media-large-up} {
    max-width: $content-width * 1.5;
    padding-left: $base-line-height * 2;
    padding-right: $base-line-height * 2;
  }

  &__list {
    box-sizing: border-box;
    display: flex;
    flex-wrap: wrap;
    list-style: none;
    margin: $base-line-height / -2;
    padding: 0;

    &__item {
      box-sizing: border-box;
      display: flex;
      margin: 0;
      padding: $base-line-height / 2;
      width: 100%;

      @media #{toolbox-sass.$media-medium-up} {
        width: 50%;
      }

      @media #{toolbox-sass.$media-large-up} {
        width: percentage(1/3);
      }
    }
  }
}

.share {
  flex-direction: row;
  justify-content: center;
  margin: ($base-line-height * 3) auto 0;

  &__rule {
    display: none;
  }

  &__title {
    font-weight: bold;
    margin: 0;
    text-align: center;
  }

  .social-share-list {
    display: flex;
    flex-direction: row;
    justify-content: center;
    line-height: 0;
    list-style: none;
    margin: 0;
    padding: 0;

    &__item {
      margin: 0 0 0 $base-line-height;
      padding: 0;

      &:first-child {
        margin: 0;
      }

      &--permalink {
        a {
          position: relative;

          &::before {
            background: url('icon-copy-link.svg');
          }

          &::after {
            background: $colour-white url('icon-check-link.svg') no-repeat center;
            background-size: $base-line-height * 1.25;
            content: '';
            display: inline-block;
            height: $base-line-height * 1.5;
            left: 0;
            opacity: 0;
            position: absolute;
            top: 0;
            transition: opacity 0.125s ease-out;
            width: $base-line-height * 1.5;
          }

          &.clipboard-success {
            &::after {
              opacity: 1;
            }
          }
        }
      }

      &--facebook {
        a {
          &::before {
            background: url('icon-facebook-link.svg');
          }
        }
      }

      &--twitter {
        a {
          &::before {
            background: url('icon-twitter-link.svg');
          }
        }
      }

      a {
        display: block;

        &::before {
          background-position: center;
          background-repeat: no-repeat;
          background-size: $base-line-height;
          content: '';
          display: inline-block;
          height: $base-line-height * 1.5;
          transition: background-size 0.125s ease-out;
          width: $base-line-height * 1.5;
        }

        &:focus,
        &:hover {
          &::before {
            background-size: $base-line-height * 1.25;
          }
        }
      }

      span {
        display: none;
      }
    }
  }
}

.sheet-of-paper {
  border: ($base-line-height / 8) solid $colour-gray;
  border-bottom: 0;
  display: flex;
  flex-direction: column-reverse;
  padding: $base-line-height $base-line-height 0;
  position: relative;
  width: 100%;

  &::after {
    bottom: $base-line-height / -8;
    background: linear-gradient(180deg, rgba($colour-white, 0), rgba($colour-white, 1));
    content: "";
    display: block;
    height: $base-line-height;
    left: $base-line-height / -8;
    position: absolute;
    right: $base-line-height / -8;
  }

  &::before {
    background: linear-gradient(180deg, $colour-gray, $colour-gray 50%, $colour-white 50%, $colour-white);
    background-size: 100% $base-line-height;
    bottom: 0;
    content: "";
    display: block;
    flex: 1;
    margin: $base-line-height 0 0 0;
    min-height: $base-line-height * 2;
    order: 1;
  }

  h2 {
    margin: 0;
    order: 2;
  }
}
